<!-- ê¸‰ì‹ -->

<!-- 
UI ë””ìì¸ ìˆ˜ì • í•„ìš”
12ì‹œ ë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‚ ì§œë¡œ ë„˜ì–´ê°€ë„ë¡ ì„¤ì • 
-->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>School Meals</title>
  <style>
     * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      color: #333;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }

    .card-box {
      background: linear-gradient(135deg, #f0f8ff, #e6f2ff);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    input[type="date"] {
      appearance: none; /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì œê±° */
      padding: 10px 20px;
      font-size: 16px;
      border: 2px solid #000;
      border-radius: 10px;
      background-color: #e0f2ff;
      color: #333;
      text-align: center;
      cursor: pointer;
      margin-bottom: 2.5rem;
      display: block;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(0.4);
      cursor: pointer;
    }

    section {
      background-color: #f0f8ff; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ (ì‹ë‹¨ í‘œ ëŠë‚Œ) */
      border: 1px solid #cce5ff;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    }

    h2 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.25rem;
      color: #1a4e8a;
    }

    ul {
      padding-left: 1rem;
    }

    li {
      margin-bottom: 0.3rem;
    }

    .empty {
      color: #aaa;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      border: 2px solid #000;
      background-color: #e0f2ff;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px;
      margin-top: 20px;
    }

   .buttons {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #f9f9f9;
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 10px 0;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    z-index: 1000;
  }

  .buttons button {
    margin: 0;
  }
  body {
    padding-bottom: 70px; 
  }

  .allergy-info {
  position: fixed;
  bottom: 70px; /* ë²„íŠ¼ ìœ„ìª½ì— ìœ„ì¹˜ (ë²„íŠ¼ ë†’ì´ì— ë§ì¶° ì¡°ì ˆ) */
  left: 0;
  width: 100%;
  font-size: 0.5rem;
  color: #666666;
  background: #f9f9f9;
  text-align: center;
  padding: 4px 10px;
  box-shadow: 0 -1px 3px rgba(0,0,0,0.1);
  z-index: 1000;
  user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ (ì„ íƒí•´ë„ ë¨) */
}
  </style>
</head>
<body>
  <div class="section card-box" id="timetable-box"></div>
  <h1> ğŸš ì˜¤ëŠ˜ì˜ ê¸‰ì‹ </h1>
  <input id="dateInput" type="date"/>

  <section>
    <h2>ğŸ± ì¤‘ì‹</h2>
    <ul id="lunchMenu">
      <li class="empty">ì¤‘ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
    </ul>
  </section>

  <section>
    <h2>ğŸ› ì„ì‹</h2>
    <ul id="dinnerMenu">
      <li class="empty">ì„ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
    </ul>
  </section>

  <script>
    const API_KEY = "7ce4be9cebd04ce0a048b3692a53c90f";
    const EDU_CODE = "F10";
    const SCHOOL_CODE = "7380182";

    const dateInput = document.getElementById("dateInput");
    const lunchMenu = document.getElementById("lunchMenu");
    const dinnerMenu = document.getElementById("dinnerMenu");

    // ì•Œë ˆë¥´ê¸° ë²ˆí˜¸ë³„ ì„±ë¶„ ë§¤í•‘
    const allergyMap = {
      1: "ë‚œë¥˜",
      2: "ìš°ìœ ",
      3: "ë©”ë°€",
      4: "ë•…ì½©",
      5: "ëŒ€ë‘",
      6: "ë°€",
      7: "ê³ ë“±ì–´",
      8: "ê²Œ",
      9: "ìƒˆìš°",
      10: "ë¼ì§€ê³ ê¸°",
      11: "ë³µìˆ­ì•„",
      12: "í† ë§ˆí† ",
      13: "ì•„í™©ì‚°ë¥˜",
      14: "í˜¸ë‘",
      15: "ë‹­ê³ ê¸°",
      16: "ì‡ ê³ ê¸°",
      17: "ì˜¤ì§•ì–´",
      18: "ì¡°ê°œë¥˜",
      19: "ì£",
    };

    // ë©”ë‰´ëª…ì—ì„œ ì•Œë ˆë¥´ê¸° ë²ˆí˜¸ ì¶”ì¶œ í›„ ì„±ë¶„ëª…ìœ¼ë¡œ ë³€í™˜
    function extractAllergyInfo(menuName) {
      const regex = /\(([\d,]+)\)/;
      const match = menuName.match(regex);
      if (!match) return "";

      const nums = match[1].split(",").map(n => n.trim());
      const allergies = nums.map(n => allergyMap[n]).filter(Boolean);
      return allergies.length ? ` (ì•Œë ˆë¥´ê¸°: ${allergies.join(", ")})` : "";
    }

    function formatDate(dateStr) {
      return dateStr.replace(/-/g, "");
    }

    async function fetchMeal(date) {
      const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=${API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${EDU_CODE}&SD_SCHUL_CODE=${SCHOOL_CODE}&MLSV_YMD=${date}`;
      try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data.mealServiceDietInfo) throw new Error("ë°ì´í„° ì—†ìŒ");

        const meals = data.mealServiceDietInfo[1].row;
        const lunch = meals.find(m => m.MMEAL_SC_NM === "ì¤‘ì‹");
        const dinner = meals.find(m => m.MMEAL_SC_NM === "ì„ì‹");

        renderMenu(lunchMenu, lunch?.DDISH_NM);
        renderMenu(dinnerMenu, dinner?.DDISH_NM);
      } catch {
        renderMenu(lunchMenu, null);
        renderMenu(dinnerMenu, null);
      }
    }

    // ê¸°ì¡´ renderMenu í•¨ìˆ˜ì— ì•Œë ˆë¥´ê¸° ì •ë³´ í‘œì‹œ ê¸°ëŠ¥ ì¶”ê°€
    function renderMenu(container, raw) {
      container.innerHTML = "";
      if (!raw) {
        const li = document.createElement("li");
        li.textContent = "ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
        li.className = "empty";
        container.appendChild(li);
        return;
      }

      const items = raw
        .split("<br/>")
        .map(item => item.trim())
        .filter(Boolean);

      for (const rawItem of items) {
        const allergyInfo = extractAllergyInfo(rawItem);
        const cleanName = rawItem.replace(/\([\d,]+\)/, "").trim();

        const li = document.createElement("li");
        li.textContent = cleanName + allergyInfo;
        container.appendChild(li);
      }
    }

    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ ì„¸íŒ…
    const today = new Date();
    dateInput.valueAsDate = today;

    dateInput.addEventListener("change", () => {
      fetchMeal(formatDate(dateInput.value));
    });

    fetchMeal(formatDate(dateInput.value)); // ì´ˆê¸° ì‹¤í–‰
  </script>
  <div class="allergy-info">
   ì•Œë ˆë¥´ê¸° ìœ ë°œ ì‹ì¬ë£Œ ë²ˆí˜¸ : 1.ë‚œë¥˜, 2.ìš°ìœ , 3.ë©”ë°€, 4.ë•…ì½©, 5.ëŒ€ë‘, 6.ë°€, 7.ê³ ë“±ì–´, 8.ê²Œ, 9.ìƒˆìš°, 10.ë¼ì§€ê³ ê¸°, 
   11.ë³µìˆ­ì•„, 12.í† ë§ˆí† , 13.ì•„í™©ì‚°ë¥˜, 14.í˜¸ë‘, 15.ë‹­ê³ ê¸°, 16.ì‡ ê³ ê¸°, 17.ì˜¤ì§•ì–´, 18.ì¡°ê°œë¥˜(êµ´, ì „ë³µ, í™í•© í¬í•¨), 19.ì£
   </div>

  <div class="buttons">
   <button onclick="goHome()">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
  </div>  
  <script>
    function goHome() {
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
